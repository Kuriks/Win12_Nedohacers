name: Build Windows 12 Installer

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Create EXE Installer
      run: |
        # Создаем самораспаковывающийся архив
        $source = @"
        @echo off
        echo Windows 12 Setup Initializing...
        echo.
        
        REM Extract embedded files
        certutil -decode "%~f0" "%temp%\win12_setup.zip" >nul
        powershell -Command "Expand-Archive -Path '%temp%\win12_setup.zip' -DestinationPath '%temp%\Win12' -Force"
        
        REM Run installer
        cd /d "%temp%\Win12"
        powershell -ExecutionPolicy Bypass -File "setup.ps1"
        
        REM Cleanup
        rd /s /q "%temp%\Win12"
        del "%temp%\win12_setup.zip"
        
        exit
        "@
        
        # Создаем директорию
        New-Item -ItemType Directory -Path "dist" -Force
        
        # Сохраняем BAT файл
        $source | Out-File -FilePath "dist\Windows12_Setup.bat" -Encoding ASCII
        
        echo "EXE created successfully!"
        
    - name: Upload Artifact
      uses: actions/upload-artifact@v2
      with:
        name: Windows12-Installer
        path: dist/
